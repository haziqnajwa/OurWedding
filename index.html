<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Our Wedding</title>
  <link rel="stylesheet" href="style_working.css" />
</head>

<body class="locked">

  <!-- Music (starts after seal tap) -->
  <audio id="bgMusic" src="music.mp3" preload="auto" loop></audio>

  <!-- Top scene: paused video -> play on seal -> after end show card_bg + flippable card -->
  <section id="scene" class="scene show" aria-label="Opening scene">

    <!-- Opening video (paused at first frame). Seal tap starts playback. -->
    <div id="openingWrap">
      <div class="videoLayer">
        <video id="openingVideo" class="openingVideo" playsinline preload="auto">
          <source src="opening.webm" type="video/webm" />
        </video>
      </div>

      <!-- Seal button overlay (acts like envelope seal) -->
      <button id="sealBtn" aria-label="Tap to open"></button>
    </div>

    <!-- Card scene shown after the video ends -->
    <div id="cardScene" class="hidden">
      <img class="bgImage" src="card_bg.webp" alt="" />

      <div class="cardLayer" id="cardLayer">
        <div class="flipCard" id="flipCard" role="button" tabindex="0" aria-label="Tap to flip invitation">
          <div class="flipInner">
            <div class="cardFace front">
              <img src="card_front.webp" alt="Invitation front" />
            </div>
            <div class="cardFace back">
              <img src="card_back.webp" alt="Invitation back" />
            </div>
          </div>
        </div>
      </div>
      <div class="tapHint">Tap the card to flip</div>
    </div>

  </section>

  <!-- Scrollable sections (enabled after the opening ends) -->
  <main id="content" class="content lockedContent" aria-label="Invitation content">

    <!-- RSVP -->
    <section class="imageSection" id="rsvp">
      <div class="imgBlock">
        <img class="sectionImg" src="rsvp.webp" alt="RSVP" />
        <div class="rsvpButtons">
          <!-- Replace the links below with your real links -->
          <a href="https://maps.app.goo.gl/" target="_blank" rel="noopener">Google Map</a>
          <a href="https://forms.gle/" target="_blank" rel="noopener">RSVP Form</a>
        </div>
      </div>
    </section>

    <!-- Countdown -->
    <section class="imageSection" id="countdown">
      <div class="imgBlock">
        <img class="sectionImg" src="countdown.webp" alt="Countdown" />
        <div id="countdownText" class="countdownOverlay">Loading…</div>
      </div>
    </section>

    <!-- Gallery -->
    <section class="imageSection" id="gallery">
      <div class="imgBlock">
        <img class="sectionImg" src="gallery.webp" alt="Gallery" />
        <div class="galleryViewport" id="galleryViewport" aria-label="Photo gallery">
          <div class="galleryTrack" id="galleryTrack">
            <div class="gallerySlide"><img src="gallery1.webp" alt="Gallery 1" /></div>
            <div class="gallerySlide"><img src="gallery2.webp" alt="Gallery 2" /></div>
            <div class="gallerySlide"><img src="gallery3.webp" alt="Gallery 3" /></div>
            <div class="gallerySlide"><img src="gallery4.webp" alt="Gallery 4" /></div>
          </div>
        </div>
        <button class="galleryBtn left" id="galleryPrev" aria-label="Previous photo">‹</button>
        <button class="galleryBtn right" id="galleryNext" aria-label="Next photo">›</button>
        <div class="galleryDots" id="galleryDots" aria-hidden="true"></div>
      </div>
    </section>

    <!-- Doa text -->
    <section class="imageSection" id="doa">
      <div class="imgBlock">
        <img class="sectionImg" src="doa_bg.webp" alt="Doa" />
        <div class="doaText" id="doaText"></div>
      </div>
    </section>

  </main>

  <script>
    // ===== Elements =====
    const body = document.body;
    const sealBtn = document.getElementById('sealBtn');
    const openingVideo = document.getElementById('openingVideo');
    const openingWrap = document.getElementById('openingWrap');
    const cardScene = document.getElementById('cardScene');
    const content = document.getElementById('content');
    const bgMusic = document.getElementById('bgMusic');

    // Flip card
    const flipCard = document.getElementById('flipCard');

    // Countdown
    const countdownText = document.getElementById('countdownText');

    // Gallery
    const galleryTrack = document.getElementById('galleryTrack');
    const galleryViewport = document.getElementById('galleryViewport');
    const galleryPrev = document.getElementById('galleryPrev');
    const galleryNext = document.getElementById('galleryNext');
    const galleryDots = document.getElementById('galleryDots');

    // Doa
    const doaTextEl = document.getElementById('doaText');
    // Paste your doa text here (already embedded, no external doa.txt needed).
    const doaFullText = `
اللَّهُمَّ اجْعَلْنَا لَكُمَا نَاصِحِينَ وَبِكُمَا فَرِحِينَ

"Dan Dia-lah yang menciptakan kamu dari tanah, kemudian apabila kamu sudah berupa manusia, maka kamu pun berkembang biak."

"Dan di antara tanda-tanda kebesaran-Nya ialah Dia menciptakan untukmu pasangan hidup dari jenismu sendiri supaya kamu merasa tenteram kepadanya, dan dijadikan-Nya di antaramu rasa kasih dan sayang."

Semoga Allah memberkati kalian berdua, menyatukan kalian dalam kebaikan, dan menjadikan rumah tangga kalian penuh sakinah, mawaddah, wa rahmah.
`;

    // ===== Helpers =====
    function unlockScroll() {
      body.classList.remove('locked');
      content.classList.remove('lockedContent');
    }

    function showCardScene() {
      openingWrap.classList.add('hidden');
      cardScene.classList.remove('hidden');
    }

    // ===== Initial video state =====
    // Ensure video shows first frame (paused) on load
    openingVideo.addEventListener('loadeddata', () => {
      try { openingVideo.pause(); openingVideo.currentTime = 0; } catch(e) {}
    }, { once: true });

    // Start video + music only when seal is tapped
    sealBtn.addEventListener('click', async () => {
      sealBtn.disabled = true;
      sealBtn.classList.add('sealDisabled');

      // Music: browsers require user gesture (this click counts)
      try {
        bgMusic.volume = 0.85;
        await bgMusic.play();
      } catch (e) {
        // If autoplay is blocked, the rest of the site still works.
      }

      // Play the opening video
      try {
        openingVideo.currentTime = 0;
        await openingVideo.play();
      } catch (e) {
        // If play fails, re-enable button
        sealBtn.disabled = false;
        sealBtn.classList.remove('sealDisabled');
      }
    });

    // When video ends, instantly switch to card_bg and unlock scrolling
    openingVideo.addEventListener('ended', () => {
      showCardScene();
      unlockScroll();
    });

    // ===== Flip card interactions =====
    function toggleFlip() {
      flipCard.classList.toggle('isFlipped');
    }
    flipCard.addEventListener('click', toggleFlip);
    flipCard.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleFlip();
      }
    });

    // ===== Countdown =====
    // Change this date/time to your actual wedding date.
    const targetDate = new Date('2026-05-02T11:30:00+08:00');
    function updateCountdown() {
      const now = new Date();
      let diff = targetDate - now;
      if (diff < 0) diff = 0;
      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      countdownText.textContent = `${days}d ${String(hours).padStart(2,'0')}h ${String(minutes).padStart(2,'0')}m ${String(seconds).padStart(2,'0')}s`;
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // ===== Gallery (buttons + swipe) =====
    const totalSlides = galleryTrack.children.length;
    let slideIndex = 0;

    function renderDots() {
      galleryDots.innerHTML = '';
      for (let i = 0; i < totalSlides; i++) {
        const dot = document.createElement('span');
        dot.className = 'dot' + (i === slideIndex ? ' active' : '');
        dot.addEventListener('click', () => goTo(i));
        galleryDots.appendChild(dot);
      }
    }

    function goTo(idx) {
      slideIndex = (idx + totalSlides) % totalSlides;
      galleryTrack.style.transform = `translateX(-${slideIndex * 100}%)`;
      renderDots();
    }

    galleryPrev.addEventListener('click', () => goTo(slideIndex - 1));
    galleryNext.addEventListener('click', () => goTo(slideIndex + 1));
    renderDots();

    // Swipe handling
    let startX = 0;
    let isDragging = false;
    galleryViewport.addEventListener('pointerdown', (e) => {
      isDragging = true;
      startX = e.clientX;
      galleryViewport.setPointerCapture(e.pointerId);
    });
    galleryViewport.addEventListener('pointermove', (e) => {
      if (!isDragging) return;
      const dx = e.clientX - startX;
      galleryTrack.style.transition = 'none';
      galleryTrack.style.transform = `translateX(calc(-${slideIndex * 100}% + ${dx}px))`;
    });
    galleryViewport.addEventListener('pointerup', (e) => {
      if (!isDragging) return;
      isDragging = false;
      const dx = e.clientX - startX;
      galleryTrack.style.transition = '';
      const threshold = 40;
      if (dx > threshold) goTo(slideIndex - 1);
      else if (dx < -threshold) goTo(slideIndex + 1);
      else goTo(slideIndex);
    });
    galleryViewport.addEventListener('pointercancel', () => { isDragging = false; goTo(slideIndex); });

    // ===== Doa typewriter (1 by 1) =====
    // Start typing when section enters view
    let doaStarted = false;
    function typeDoa() {
      if (doaStarted) return;
      doaStarted = true;
      const text = doaFullText.trim();
      let i = 0;
      doaTextEl.textContent = '';
      const timer = setInterval(() => {
        doaTextEl.textContent += text[i] ?? '';
        i++;
        if (i >= text.length) clearInterval(timer);
      }, 22);
    }

    const doaObserver = new IntersectionObserver((entries) => {
      for (const entry of entries) {
        if (entry.isIntersecting) typeDoa();
      }
    }, { threshold: 0.35 });
    doaObserver.observe(document.getElementById('doa'));
  </script>

</body>
</html>
