<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Our Wedding</title>
<link rel="stylesheet" href="style.css" />
</head>

<body class="locked">

<audio id="bgMusic" loop>
  <source src="music.mp3" type="audio/mpeg" />
</audio>

<button id="musicToggle" class="musicBtn">ðŸ”Š</button>

<!-- OPENING -->
<section id="openingSection" class="openingSection">
  <div class="stage">
    <div id="openingCover" class="openingCover">
      <img class="stageMedia" src="opening.webp" />
      <button id="openHit" class="openHit">
        <span class="tapText">Tap seal to open</span>
      </button>
    </div>

    <video id="openingVideo" class="stageMedia hidden" playsinline preload="metadata">
      <source src="opening.webm" type="video/webm" />
    </video>
  </div>
</section>

<main id="mainContent" class="slides lockedContent">

  <!-- CARD -->
  <section class="slide">
    <div class="stage">
      <img class="stageMedia" src="card_bg.webp" />

      <div class="overlay">
        <div class="cardSlot">
          <button class="flipWrap" id="flipWrap">
            <div class="flipCard" id="flipCard">
              <div class="flipFace flipFront">
                <img src="card_front.webp">
              </div>
              <div class="flipFace flipBack">
                <img src="card_back.webp">
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- DOA -->
  <section class="slide">
    <div class="stage">
      <img class="stageMedia" src="doa_bg.webp" />
      <div class="overlay">
        <div class="doaOverlay">
          <div id="doaType" class="doaType"
data-text="(30:21) And of His signs is that He created for you from yourselves mates that you may find tranquility in them; and He placed between you affection and mercy. Verily in that are signs for those who reflect.

(7:189) It is He who created you from one soul and created from it its mate that he might dwell in security with her; And when he covers her, she carries a light burden and continues therein; And when it becomes heavy, they both invoke Allah, their Lord, â€œIf You should give us a good [child], we will surely be among the grateful.â€">
          </div>
        </div>
      </div>
    </div>
  </section>

</main>

<script>

const body = document.body;
const openingSection = document.getElementById("openingSection");
const openingCover   = document.getElementById("openingCover");
const openingVideo   = document.getElementById("openingVideo");
const openHit        = document.getElementById("openHit");
const mainContent    = document.getElementById("mainContent");
const music          = document.getElementById("bgMusic");
const musicBtn       = document.getElementById("musicToggle");

let opened = false;

openHit.addEventListener("click", async () => {
  if (opened) return;
  opened = true;

  try { await music.play(); } catch(e){}

  openingCover.classList.add("hidden");
  openingVideo.classList.remove("hidden");

  try { await openingVideo.play(); }
  catch(e){
    openingVideo.classList.add("hidden");
    openingCover.classList.remove("hidden");
    opened = false;
  }
});

openingVideo.addEventListener("ended", () => {
  openingSection.style.display = "none";
  body.classList.remove("locked");
  mainContent.classList.remove("lockedContent");
  initDoaTyping();
});

musicBtn.addEventListener("click", async () => {
  if (music.paused) {
    try { await music.play(); } catch(e){}
    musicBtn.textContent = "ðŸ”Š";
  } else {
    music.pause();
    musicBtn.textContent = "ðŸ”‡";
  }
});

document.getElementById("flipWrap")
.addEventListener("click", () =>
  document.getElementById("flipCard").classList.toggle("isFlipped")
);

/* STRICT TEXT FITTER */
function fitTextToBox(box, text, minPx, maxPx) {

  const meas = document.createElement("div");
  meas.style.position = "absolute";
  meas.style.visibility = "hidden";
  meas.style.width = box.clientWidth + "px";
  meas.style.height = box.clientHeight + "px";
  meas.style.whiteSpace = "pre-wrap";
  meas.style.overflow = "hidden";
  meas.style.lineHeight = getComputedStyle(box).lineHeight;
  meas.style.fontWeight = getComputedStyle(box).fontWeight;
  meas.style.textAlign = "center";
  meas.textContent = text;
  document.body.appendChild(meas);

  let lo = minPx, hi = maxPx, best = minPx;

  for (let i=0;i<20;i++){
    let mid = (lo+hi)/2;
    meas.style.fontSize = mid+"px";
    if (meas.scrollHeight <= meas.clientHeight) {
      best = mid;
      lo = mid;
    } else {
      hi = mid;
    }
  }

  document.body.removeChild(meas);
  box.style.fontSize = best+"px";
}

function initDoaTyping(){
  const box = document.getElementById("doaType");
  const text = box.dataset.text;

  fitTextToBox(box, text, 9, 17);

  box.textContent="";
  let i=0;

  const timer=setInterval(()=>{
    box.textContent += text[i] ?? "";
    i++;
    if(i>=text.length) clearInterval(timer);
  },12);

  window.addEventListener("resize",()=>{
    fitTextToBox(box,text,9,17);
  });
}

</script>

</body>
</html>
